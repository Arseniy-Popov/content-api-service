services:
    # tests:
    #     build:
    #         context: ./.
    #         dockerfile: Dockerfile
    #     depends_on:
    #         - app
    #         - elasticsearch
    #         - redis
    #         - nginx
    #     volumes:
    #         - ./:/tests
    #     environment:
    #         - ENVIRONMENT=production
    #         - PYTHONUNBUFFERED=1
    #         - PYTHONDONTWRITEBYTECODE=1
    #         - REDIS_PATH=redis://redis:6379/0
    #         - ELASTICSEARCH_PATH=http://elasticsearch:9200
    #     env_file:
    #         - ./.env
    app:
        build:
            context: ../../.
            dockerfile: ../../Dockerfile
        volumes:
            - ../../.:/app
        environment:
            - ENVIRONMENT=testing
            - PYTHONUNBUFFERED=1
            - PYTHONDONTWRITEBYTECODE=1
            - REDIS_PATH=redis://redis:6379/0
            - ELASTIC_PATH=http://elasticsearch:9200
        env_file:
            - ./.env
    nginx:
        build: ../../infra/nginx
        ports:
            - 80:80
        depends_on:
            - app
    elasticsearch:
        image: elasticsearch:8.2.2
        environment:
            - discovery.type=single-node
            - xpack.security.http.ssl.enabled=false
            - xpack.security.enabled=false
        volumes:
            - elasticsearch:/usr/share/elasticsearch/data
        expose:
            - 9200
        ports:
            - 9200:9200
    redis:
        image: redis
        expose:
            - 6379
        ports:
            - 6379:6379

volumes:
    elasticsearch:
